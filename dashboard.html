<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Carbon Dashboard</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body {
      background-color: #0b1b2b;
      color: #e0f2f1;
      font-family: 'Poppins', sans-serif;
    }
    .navbar1 {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 1rem 3rem;
  background: rgba(15, 25, 40, 0.9);
  border-bottom: 1px solid #1e2d46;
  position: relative;
  flex-wrap: wrap;
}

.logo {
  display: flex;
  align-items: center;
  gap: 8px;
  font-weight: 700;
  font-size: 1.3rem;
  color: #4cffc0;
}

.logo img {
  width: 26px;
  height: 26px;
  filter: brightness(0) saturate(100%) invert(67%) sepia(88%) saturate(334%) hue-rotate(92deg) brightness(101%) contrast(90%);
}

.nav-links {
  display: flex;
  gap: 1.5rem;
}

.nav-links a {
  color: #b7c8d6;
  text-decoration: none;
  font-weight: 500;
  transition: 0.2s;
}

.nav-links a:hover {
  color: #4cffc0;
}

.profile .circle {
  background-color: #2b3c56;
  color: #fff;
  width: 35px;
  height: 35px;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: 600;
  font-size: 1rem;
}

.menu-toggle {
  display: none;
  font-size: 1.8rem;
  cursor: pointer;
  color: #4cffc0;
}

    .navbar {
      background-color: #092038;
      padding: 10px 20px;
    }
    .navbar-brand {
      color: #36d399;
      font-weight: bold;
    }
    .tab-btn {
      background: none;
      border: none;
      color: #36d399;
      font-size: 16px;
      margin: 0 10px;
      cursor: pointer;
      transition: all 0.2s;
    }
    .tab-btn:hover {
      opacity: 0.8;
    }
    .tab-btn.active {
      border-bottom: 3px solid #36d399;
    }
    .card {
      background-color: #102841;
      border-radius: 12px;
      padding: 20px;
      margin: 10px;
      color: white;
      box-shadow: 0 0 10px rgba(54, 211, 153, 0.2);
    }
    #loader {
      display: flex;
      justify-content: center;
      align-items: center;
      height: 70vh;
      color: #36d399;
      font-size: 1.5rem;
    }
    canvas {
      background: transparent;
    }
    .tab-content {
      display: none;
    }
    .tab-content.active {
      display: block;
    }

    /* --------------------- Footer ------------------------------ */
.footer {
  text-align: center;
  padding: 1rem;
  font-size: 0.85rem;
  color: #a8b4c3;
  background: rgba(15, 25, 40, 0.9);
  border-top: 1px solid #1e2d46;
}
  </style>
</head>
<body>
  <header class="navbar1">
    <div class="logo">
      <img src="https://cdn-icons-png.flaticon.com/512/616/616408.png" alt="Carbo Logo">
      <span>EcoMetric AI</span>
      <a href="/" class="btn" style="color: #36d399;">Logout</a>
    </div>
    <nav class="nav-links">
      <a href="/home">Home</a>
      <a href="#about">About</a>
      <a href="#features">Features</a>
      <a href="/calculate">Personal Tracker</a>
      <a href="/simulate_ml_run">Software/ML Tracker</a>
      <a href="/dashboard">Dashboard</a>
    </nav>
    <div class="profile">
      <div class="circle">F</div>
    </div>
    <div class="menu-toggle">&#9776;</div>
  </header>
  <nav class="navbar d-flex justify-content-between">
    <div>
      <button class="tab-btn active" data-tab="overview">Overview</button>
      <button class="tab-btn" data-tab="charts">Charts</button>
      <button class="tab-btn" data-tab="comparison">Comparison</button>
    </div>
  </nav>

  <div id="loader">Loading Dashboard...</div>

  <div class="container mt-4" id="dashboard-content" style="display:none;">
    <!-- Overview -->
    <div class="tab-content active" id="overview">
      <div class="card text-center">
        <h3>Carbon Status</h3>
        <h1 id="totalFootprint" class="text-warning">-- kg CO₂</h1>
        <p class="text-secondary">Medium Impact</p>
      </div>
      <div class="card">
        <h5>Carbon Trends</h5>
        <canvas id="trendChart" height="100"></canvas>
      </div>
    </div>

    <!-- Charts -->
    <div class="tab-content" id="charts">
      <div class="card">
        <h5>Impact by Category</h5>
        <canvas id="pieChart" height="40"></canvas>
      </div>
      <div class="card">
        <h5>Category Breakdown</h5>
        <canvas id="radarChart" height="40"></canvas>
      </div>
    </div>

    <!-- Comparison -->
    <div class="tab-content" id="comparison">
      <div class="card">
        <h4>Compare Monthly Footprints</h4>
        <canvas id="compareChart" height="120"></canvas>
      </div>
    </div>
  </div>

      <footer class="footer">
    <p>© 2025 EcoMetricAI. Track • Reduce • Improve.</p>
  </footer>

  <script>
    document.addEventListener("DOMContentLoaded", async function () {
      const loader = document.getElementById("loader");
      const content = document.getElementById("dashboard-content");

      try {
        const res = await fetch("/api/dashboard-data/");
        const data = await res.json();

        loader.style.display = "none";
        content.style.display = "block";

        document.getElementById("totalFootprint").textContent = data.latest_total + " kg CO₂";

        const labels = data.monthly.map(e => e.date);
        const values = data.monthly.map(e => e.total_footprint);

        // Line Chart
        new Chart(document.getElementById("trendChart"), {
          type: "line",
          data: {
            labels: labels,
            datasets: [{
              label: "Monthly Carbon Footprint",
              data: values,
              borderColor: "#36d399",
              fill: false,
              tension: 0.3
            }]
          },
          options: {
            plugins: { legend: { labels: { color: "#e0f2f1" } } },
            scales: { x: { ticks: { color: "#e0f2f1" } }, y: { ticks: { color: "#e0f2f1" } } }
          }
        });

        // Pie Chart
        new Chart(document.getElementById("pieChart"), {
          type: "pie",
          data: {
            labels: ["Transportation", "Energy Use", "Food", "Waste", "Water", "Shopping"],
            datasets: [{
              data: [35, 20, 15, 10, 8, 12],
              backgroundColor: ["#36d399","#059669","#22d3ee","#3b82f6","#9333ea","#facc15"]
            }]
          }
        });

        // Radar Chart
        new Chart(document.getElementById("radarChart"), {
          type: "radar",
          data: {
            labels: ["Transportation", "Energy Use", "Food", "Waste", "Water", "Shopping"],
            datasets: [{
              label: "Category Breakdown",
              data: [450, 300, 250, 150, 100, 200],
              borderColor: "#36d399",
              backgroundColor: "rgba(54,211,153,0.2)"
            }]
          },
          options: { scales: { r: { grid: { color: "#1e3a8a" }, angleLines: { color: "#1e3a8a" } } } }
        });

        // Comparison Chart
        new Chart(document.getElementById("compareChart"), {
          type: "bar",
          data: {
            labels: labels,
            datasets: [{
              label: "Monthly Footprint Comparison",
              data: values,
              backgroundColor: "#36d399"
            }]
          },
          options: {
            plugins: { legend: { labels: { color: "#e0f2f1" } } },
            scales: { x: { ticks: { color: "#e0f2f1" } }, y: { ticks: { color: "#e0f2f1" } } }
          }
        });

      } catch (err) {
        loader.textContent = "Error loading dashboard data!";
      }
    });

    // ✅ Tab Switching Logic (Fixed)
    document.addEventListener("click", (e) => {
      if (e.target.classList.contains("tab-btn")) {
        document.querySelectorAll(".tab-btn").forEach(btn => btn.classList.remove("active"));
        e.target.classList.add("active");

        const tabId = e.target.dataset.tab;
        document.querySelectorAll(".tab-content").forEach(tab => tab.classList.remove("active"));
        document.getElementById(tabId).classList.add("active");
      }
    });
  </script>
</body>
</html>
